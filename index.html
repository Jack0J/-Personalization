<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Футболка игровая 2K Sport Ultra - 2K Shop</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
</head>
<body>
    <div class="product-page">
        <!-- Хлебные крошки -->
        <div class="breadcrumbs">
            <a href="#">Главная</a> <span>/</span>
            <a href="#">Каталог</a> <span>/</span>
            <a href="#">Футболки игровые</a> <span>/</span>
            <span>Футболка игровая 2K Sport Ultra</span>
        </div>

        <!-- Сетка карточки товара -->
        <div class="product-grid">
            <!-- Левая колонка: галерея -->
            <div class="product-gallery">
                <div class="main-image">
                    <img src="https://via.placeholder.com/500x500/1a2a6a/ffffff?text=2K+Sport+Ultra+Blue" alt="Футболка игровая 2K Sport Ultra синий">
                </div>
                <div class="thumbnail-list">
                    <div class="thumbnail active">
                        <img src="https://via.placeholder.com/80x80/1a2a6a/ffffff?text=1" alt="Вид 1">
                    </div>
                    <div class="thumbnail">
                        <img src="https://via.placeholder.com/80x80/2a3a7a/ffffff?text=2" alt="Вид 2">
                    </div>
                    <div class="thumbnail">
                        <img src="https://via.placeholder.com/80x80/3a4a8a/ffffff?text=3" alt="Вид 3">
                    </div>
                </div>
            </div>

            <!-- Правая колонка: информация -->
            <div class="product-info">
                <h1>Футболка игровая 2K Sport Ultra, синий цвет</h1>
                <div class="product-sku">Арт.: 120065 | Цвет: синий/темно-синий</div>
                <div class="product-price">1 990 ₽</div>

                <!-- Блок выбора размера -->
                <div class="size-selector">
                    <div class="size-header">
                        <span class="size-title">Наличие: выберите размер</span>
                        <a href="#" class="size-table-link">ТАБЛИЦА РАЗМЕРОВ</a>
                    </div>
                    <div class="size-buttons">
                        <button class="size-btn">XS</button>
                        <button class="size-btn">S</button>
                        <button class="size-btn selected">M</button>
                        <button class="size-btn">L</button>
                        <button class="size-btn">XL</button>
                        <button class="size-btn">XXL</button>
                        <button class="size-btn">XXXL</button>
                    </div>
                </div>

                <!-- Обычная кнопка "Добавить в корзину" (черная) -->
                <button class="btn-add-to-cart-main" id="addToCartMainBtn">
                    Добавить в корзину
                </button>

                <!-- Текст перед кнопкой (обведен рамкой вместе с кнопкой) -->
                <div class="panel-trigger-wrapper">
                    <div class="panel-trigger-text">
                        Выберите размер и добавьте в корзину товары, чтобы добавить нанесение на экипировку.
                    </div>
                    <!-- КНОПКА ОТКРЫТИЯ ПАНЕЛИ (СИНЯЯ) -->
                    <button class="btn-open-panel" id="openDrawerBtn">
                        <span>+</span> Добавить нанесение для экипировки
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== ВЫДВИЖНАЯ ПАНЕЛЬ ===== -->
        <div class="drawer-overlay" id="drawerOverlay"></div>
        <div class="drawer-panel" id="drawerPanel">
            <div class="drawer-content">
                <!-- Шапка -->
                <div class="drawer-header">
                    <span class="drawer-title">Нанесение для экипировки</span>
                    <button class="drawer-close" id="closeDrawerBtn">✕</button>
                </div>

                <!-- Контент -->
                <div class="drawer-scrollable">
                    
                    <!-- 1. ИНФОРМАЦИОННЫЙ БЛОК -->
                    <div class="info-block">
                        <p>В этом разделе вы можете добавить нанесение на экипировку для игрока или команды.</p>
                        <p>Доступные возможности:</p>
                        <ul class="services-list">
                            <li><span class="service-number">1</span> большой номер — 190 ₽</li>
                            <li><span class="service-number">2</span> малый номер — 150 ₽</li>
                            <li><span class="service-number">3</span> логотип команды — 320 ₽</li>
                            <li><span class="service-number">4</span> логотип спонсорский большой — 590 ₽</li>
                            <li><span class="service-number">5</span> фамилия или название команды — 290 ₽</li>
                        </ul>
                        <p class="info-note">Обратите внимание: товары с нанесением не подлежат возврату и требуют предоплаты.</p>
                        <p>Больше вариантов персонализации вы найдёте в разделе <a href="#">«Нанесение и вышивка»</a>.</p>
                    </div>

                    <!-- 2. КНОПКА "РАСПОЛОЖЕНИЕ НАНЕСЕНИЯ" -->
                    <div class="section">
                        <button class="btn-location" id="showLocationBtn">
                            <i data-feather="info"></i> Расположение нанесения
                        </button>
                    </div>

                    <!-- 3. БЛОК ТОВАРОВ ДЛЯ НАНЕСЕНИЯ -->
                    <div class="section">
                        <div class="section-title">Товары для нанесения</div>
                        <div class="cart-items-horizontal" id="cartItemsHorizontal">
                            <!-- Товар 1 (120050) -->
                            <div class="cart-item-horizontal selected" data-art="120050">
                                <div class="cart-item-content">
                                    <div class="cart-item-image-small">
                                        <img src="https://private-user-images.githubusercontent.com/215157183/552557711-26061973-23d0-4930-a4b9-884fe271ddb0.jpg?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE1ODc2MzAsIm5iZiI6MTc3MTU4NzMzMCwicGF0aCI6Ii8yMTUxNTcxODMvNTUyNTU3NzExLTI2MDYxOTczLTIzZDAtNDkzMC1hNGI5LTg4NGZlMjcxZGRiMC5qcGc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjYwMjIwJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI2MDIyMFQxMTM1MzBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT00ZTBiZTQxZDg3OTkwYTJkNThlNWUwYzQ5ZjA2ZDY4NDA4ZWU4MGE1NGZiNDc5NTFlZGVkZDNlY2ZjMzQ1M2QzJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.P4pPUm3e3x7MxFCp-1hUpB904-_3vwhgBEbnNPgjY7E" alt="Футболка">
                                    </div>
                                    <div class="cart-item-info-small">
                                        <div class="cart-item-name-small">Футболка Classic III</div>
                                        <div class="cart-item-art-small">Арт. 120050</div>
                                    </div>
                                </div>
                                <div class="cart-item-check-small">✓</div>
                            </div>
                            
                            <!-- Товар 2 (120222) -->
                            <div class="cart-item-horizontal" data-art="120222">
                                <div class="cart-item-content">
                                    <div class="cart-item-image-small">
                                        <img src="https://private-user-images.githubusercontent.com/215157183/552557745-67a1b9b8-530f-4134-bd7a-8ed6c613c442.jpg?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE1ODc2MzAsIm5iZiI6MTc3MTU4NzMzMCwicGF0aCI6Ii8yMTUxNTcxODMvNTUyNTU3NzQ1LTY3YTFiOWI4LTUzMGYtNDEzNC1iZDdhLThlZDZjNjEzYzQ0Mi5qcGc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjYwMjIwJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI2MDIyMFQxMTM1MzBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT04YjFlMDVhYjI0N2NiYjhmOGE3OThmMTkxNWE5NDIzYzEyM2QwZjI2MzAzNDkzZjYzNDBkMzYzZjY2OGZlMzljJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.Q1p_ymmTx38rsM31AHjSQ3HCSN2zrke3ngg0KncWy0w" alt="Шорты">
                                    </div>
                                    <div class="cart-item-info-small">
                                        <div class="cart-item-name-small">Шорты Classic III</div>
                                        <div class="cart-item-art-small">Арт. 120222</div>
                                    </div>
                                </div>
                                <div class="cart-item-check-small">✓</div>
                            </div>
                        </div>
                    </div>

                    <!-- 4. ИГРОКИ -->
                    <div class="section">
                        <div class="section-title">Игроки</div>
                        <div id="playersContainer"></div>
                        
                        <!-- Счётчик игроков -->
                        <div class="player-counter" id="playerCounter">
                            Кол-во игроков: 1
                        </div>
                        
                        <!-- Кнопка добавления игрока -->
                        <div class="add-player-section">
                            <button class="btn-add-player" id="addPlayerBtn">
                                <i data-feather="plus-circle"></i> Добавить игрока
                            </button>
                        </div>
                        
                        <!-- Итоговая цена -->
                        <div class="total-price" id="totalPrice">
                            <span>Итого по всем товарам:</span> <span id="totalPriceValue">0 ₽</span>
                        </div>
                        
                        <!-- Кнопка в корзину (ЧЕРНАЯ) -->
                        <button class="btn-cart" id="addToCartBtn">
                            Добавить в корзину
                        </button>
                        
                        <!-- Дисклеймер -->
                        <div class="disclaimer">
                            * Нажимая «Добавить в корзину», вы подтверждаете, что товары с нанесением будут добавлены в корзину с указанными параметрами.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- МОДАЛЬНОЕ ОКНО ДЛЯ РАСПОЛОЖЕНИЯ НАНЕСЕНИЯ -->
    <div class="modal-overlay" id="locationModalOverlay">
        <div class="modal-container">
            <div class="modal-header">
                <span class="modal-title">Расположение нанесения</span>
                <button class="modal-close" id="closeLocationModalBtn">✕</button>
            </div>
            <div class="modal-content">
                <img src="https://private-user-images.githubusercontent.com/215157183/552557773-f1f72c8e-56b7-4bee-b39b-87f42a9bf8c7.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE1ODgyNTgsIm5iZiI6MTc3MTU4Nzk1OCwicGF0aCI6Ii8yMTUxNTcxODMvNTUyNTU3NzczLWYxZjcyYzhlLTU2YjctNGJlZS1iMzliLTg3ZjQyYTliZjhjNy5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjYwMjIwJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI2MDIyMFQxMTQ1NThaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT01NGExOTI2NzQ1NjE5ODk0Yjc0NWVlZmVhNzEzMDE3YWMzZjM1ZmIzYTE3ZDIxZTZiNmI4MmZkZDAxOWUzMzA4JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.6j6qpfrCQS_he6-ZXXadHuQKorT_3qkGcDS7yKwzJtA" 
                     alt="Схема расположения нанесения" 
                     class="location-image">
                <p class="location-description">Схема расположения номеров, фамилии и логотипов на экипировке</p>
            </div>
        </div>
    </div>

    <!-- МОДАЛЬНОЕ ОКНО ПОДТВЕРЖДЕНИЯ ДОБАВЛЕНИЯ В КОРЗИНУ -->
    <div class="modal-overlay" id="confirmModalOverlay">
        <div class="modal-container confirm-modal">
            <div class="modal-header">
                <span class="modal-title">Товары нанесения добавлены в корзину</span>
                <button class="modal-close" id="closeConfirmModalBtn">✕</button>
            </div>
            <div class="modal-content confirm-content">
                <p class="confirm-subtitle">Проверьте выбранные опции:</p>
                
                <!-- Сюда будет вставляться список товаров -->
                <div id="confirmItemsList" class="confirm-items-list"></div>
                
                <div class="confirm-total">
                    <span>Итого, товары нанесения:</span>
                    <span id="confirmTotalPrice">0 ₽</span>
                </div>
                
                <div class="confirm-actions">
                    <button class="btn-confirm-primary" id="goToCartBtn">Перейти в корзину</button>
                    <button class="btn-confirm-secondary" id="continueShoppingBtn">Продолжить покупки</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            feather.replace();

            // ===== ЭЛЕМЕНТЫ =====
            const overlay = document.getElementById('drawerOverlay');
            const drawer = document.getElementById('drawerPanel');
            const openBtn = document.getElementById('openDrawerBtn');
            const closeBtn = document.getElementById('closeDrawerBtn');
            const playersContainer = document.getElementById('playersContainer');
            const playerCounter = document.getElementById('playerCounter');
            const totalPriceValue = document.getElementById('totalPriceValue');
            const addPlayerBtn = document.getElementById('addPlayerBtn');
            
            // Элементы модального окна расположения
            const locationModalOverlay = document.getElementById('locationModalOverlay');
            const showLocationBtn = document.getElementById('showLocationBtn');
            const closeLocationModalBtn = document.getElementById('closeLocationModalBtn');
            
            // Элементы модального окна подтверждения
            const confirmModalOverlay = document.getElementById('confirmModalOverlay');
            const closeConfirmModalBtn = document.getElementById('closeConfirmModalBtn');
            const confirmItemsList = document.getElementById('confirmItemsList');
            const confirmTotalPrice = document.getElementById('confirmTotalPrice');
            const goToCartBtn = document.getElementById('goToCartBtn');
            const continueShoppingBtn = document.getElementById('continueShoppingBtn');
            
            // ===== НОВЫЕ ЦЕНЫ =====
            const PRICES = {
                bigNumber: 190,
                smallNumber: 150,
                surname: 290,
                teamLogo: 320,
                sponsorLogo: 590
            };

            // ===== СОСТОЯНИЕ ДЛЯ РАЗНЫХ АРТИКУЛОВ =====
            const itemsState = {
                '120050': {
                    players: [],
                    teamLogo: false,
                    sponsorLogo: false,
                    color: 'white'
                },
                '120222': {
                    players: [],
                    teamLogo: false,
                    sponsorLogo: false,
                    color: 'white'
                }
            };

            // ===== ТЕКУЩИЙ ВЫБРАННЫЙ АРТИКУЛ =====
            let currentArticle = '120050';

            // ===== ОТКРЫТИЕ/ЗАКРЫТИЕ ПАНЕЛИ =====
            function openDrawer() {
                overlay.classList.add('active');
                drawer.classList.add('open');
                document.body.style.overflow = 'hidden';
            }
            
            function closeDrawer() {
                overlay.classList.remove('active');
                drawer.classList.remove('open');
                document.body.style.overflow = '';
            }
            
            openBtn.addEventListener('click', openDrawer);
            closeBtn.addEventListener('click', closeDrawer);
            overlay.addEventListener('click', closeDrawer);
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && drawer.classList.contains('open')) {
                    closeDrawer();
                }
            });

            // ===== МОДАЛЬНОЕ ОКНО РАСПОЛОЖЕНИЯ =====
            showLocationBtn.addEventListener('click', function() {
                locationModalOverlay.classList.add('active');
            });

            closeLocationModalBtn.addEventListener('click', function() {
                locationModalOverlay.classList.remove('active');
            });

            locationModalOverlay.addEventListener('click', function(e) {
                if (e.target === locationModalOverlay) {
                    locationModalOverlay.classList.remove('active');
                }
            });

            // ===== ПЕРЕКЛЮЧЕНИЕ ТОВАРОВ =====
            const cartItemsHorizontal = document.querySelectorAll('.cart-item-horizontal');
            cartItemsHorizontal.forEach(item => {
                item.addEventListener('click', function() {
                    cartItemsHorizontal.forEach(i => i.classList.remove('selected'));
                    this.classList.add('selected');
                    currentArticle = this.dataset.art;
                    loadStateForCurrentArticle();
                });
            });

            // ===== ЗАГРУЗКА СОСТОЯНИЯ ДЛЯ ТЕКУЩЕГО АРТИКУЛА =====
            function loadStateForCurrentArticle() {
                const state = itemsState[currentArticle];
                
                // Очищаем контейнер игроков
                playersContainer.innerHTML = '';
                
                // Загружаем игроков
                if (state.players.length === 0) {
                    addNewPlayer(true); // Добавляем первого игрока по умолчанию
                } else {
                    state.players.forEach((player, index) => {
                        addPlayerFromState(player, index + 1);
                    });
                }
                
                // Обновляем счетчик
                updatePlayerCounter();
                
                // Обновляем обработчики
                setupNumberInputs();
                setupDeleteButtons();
                updateDeleteButtonsState();
                
                // Обновляем общую цену
                updateTotalPrice();
            }

            // ===== ДОБАВЛЕНИЕ ИГРОКА ИЗ СОСТОЯНИЯ =====
            function addPlayerFromState(player, playerNumber) {
                const isShorts = currentArticle === '120222';
                
                const newPlayer = document.createElement('div');
                newPlayer.className = 'player-card';
                newPlayer.innerHTML = `
                    <div class="player-header">
                        <span class="player-name">Игрок ${playerNumber}</span>
                        <button class="player-delete ${playerNumber > 1 ? 'active' : ''}" ${playerNumber === 1 ? 'disabled' : ''}>
                            <i data-feather="trash-2"></i>
                        </button>
                    </div>
                    
                    <!-- Первая строка: Размер и Цвет нанесения -->
                    <div class="player-row">
                        <div class="field-group">
                            <label class="field-label">Размер</label>
                            <select class="field-select" data-player="${playerNumber}">
                                <option value="">Выберите размер</option>
                                <option value="XS" ${player.size === 'XS' ? 'selected' : ''}>XS</option>
                                <option value="S" ${player.size === 'S' ? 'selected' : ''}>S</option>
                                <option value="M" ${player.size === 'M' ? 'selected' : ''}>M</option>
                                <option value="L" ${player.size === 'L' ? 'selected' : ''}>L</option>
                                <option value="XL" ${player.size === 'XL' ? 'selected' : ''}>XL</option>
                                <option value="XXL" ${player.size === 'XXL' ? 'selected' : ''}>XXL</option>
                                <option value="XXXL" ${player.size === 'XXXL' ? 'selected' : ''}>XXXL</option>
                            </select>
                        </div>
                        <div class="field-group">
                            <label class="field-label">Цвет нанесения</label>
                            <select class="field-select color-select" data-player="${playerNumber}">
                                <option value="white" ${player.color === 'white' ? 'selected' : ''}>Белый</option>
                                <option value="black" ${player.color === 'black' ? 'selected' : ''}>Чёрный</option>
                                <option value="red" ${player.color === 'red' ? 'selected' : ''}>Красный</option>
                                <option value="blue" ${player.color === 'blue' ? 'selected' : ''}>Синий</option>
                                <option value="yellow" ${player.color === 'yellow' ? 'selected' : ''}>Жёлтый</option>
                                <option value="green" ${player.color === 'green' ? 'selected' : ''}>Зелёный</option>
                                <option value="orange" ${player.color === 'orange' ? 'selected' : ''}>Оранжевый</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Вторая строка: Фамилия, Большой номер, Малый номер -->
                    <div class="player-row">
                        <div class="field-group">
                            <label class="field-label">Фамилия/команда (290 ₽)</label>
                            <input class="field-input ${isShorts ? 'disabled-field' : ''}" type="text" placeholder="Введите фамилию" maxlength="12" value="${player.surname || ''}" ${isShorts ? 'disabled' : ''}>
                        </div>
                        <div class="field-group">
                            <label class="field-label">Большой номер (190 ₽)</label>
                            <input class="field-input number-input ${isShorts ? 'disabled-field' : ''}" type="text" inputmode="numeric" pattern="\\d*" placeholder="0-99" value="${player.bigNumber || ''}" ${isShorts ? 'disabled' : ''}>
                            <div class="input-hint">только цифры</div>
                        </div>
                        <div class="field-group">
                            <label class="field-label">Малый номер (150 ₽)</label>
                            <input class="field-input number-input" type="text" inputmode="numeric" pattern="\\d*" placeholder="0-99" value="${player.smallNumber || ''}">
                            <div class="input-hint">только цифры</div>
                        </div>
                    </div>
                    
                    <!-- Третья строка: Чекбоксы для логотипов -->
                    <div class="player-row logos-row">
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" class="logo-checkbox team-logo" data-player="${playerNumber}" ${player.teamLogo ? 'checked' : ''}>
                                <span>Логотип команды (320 ₽)</span>
                            </label>
                        </div>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" class="logo-checkbox sponsor-logo" data-player="${playerNumber}" ${player.sponsorLogo ? 'checked' : ''}>
                                <span>Большой логотип (590 ₽)</span>
                            </label>
                        </div>
                    </div>
                `;
                
                playersContainer.appendChild(newPlayer);
                
                // Добавляем обработчики для чекбоксов
                const teamLogoCheckbox = newPlayer.querySelector('.team-logo');
                const sponsorLogoCheckbox = newPlayer.querySelector('.sponsor-logo');
                
                if (teamLogoCheckbox) {
                    teamLogoCheckbox.addEventListener('change', function() {
                        saveCurrentState();
                        updateTotalPrice();
                    });
                }
                
                if (sponsorLogoCheckbox) {
                    sponsorLogoCheckbox.addEventListener('change', function() {
                        saveCurrentState();
                        updateTotalPrice();
                    });
                }
            }

            // ===== СОХРАНЕНИЕ СОСТОЯНИЯ ТЕКУЩЕГО АРТИКУЛА =====
            function saveCurrentState() {
                const state = itemsState[currentArticle];
                const players = [];
                
                document.querySelectorAll('.player-card').forEach(card => {
                    const sizeSelect = card.querySelector('.player-row:first-child .field-select:not(.color-select)');
                    const colorSelect = card.querySelector('.color-select');
                    const surnameInput = card.querySelector('.player-row:nth-child(3) .field-group:nth-child(1) input');
                    const bigNumberInput = card.querySelector('.player-row:nth-child(3) .field-group:nth-child(2) input');
                    const smallNumberInput = card.querySelector('.player-row:nth-child(3) .field-group:nth-child(3) input');
                    const teamLogoCheckbox = card.querySelector('.team-logo');
                    const sponsorLogoCheckbox = card.querySelector('.sponsor-logo');
                    
                    players.push({
                        size: sizeSelect ? sizeSelect.value : '',
                        color: colorSelect ? colorSelect.value : 'white',
                        surname: surnameInput ? surnameInput.value : '',
                        bigNumber: bigNumberInput ? bigNumberInput.value : '',
                        smallNumber: smallNumberInput ? smallNumberInput.value : '',
                        teamLogo: teamLogoCheckbox ? teamLogoCheckbox.checked : false,
                        sponsorLogo: sponsorLogoCheckbox ? sponsorLogoCheckbox.checked : false
                    });
                });
                
                state.players = players;
            }

            // ===== ВАЛИДАЦИЯ ЦИФР =====
            function setupNumberInputs() {
                const numberInputs = document.querySelectorAll('.number-input:not(:disabled)');
                numberInputs.forEach(input => {
                    input.removeEventListener('input', handleNumberInput);
                    input.addEventListener('input', handleNumberInput);
                });
            }
            
            function handleNumberInput(e) {
                this.value = this.value.replace(/[^\d]/g, '').slice(0, 2);
                saveCurrentState();
                updateTotalPrice();
            }
            
            // ===== УДАЛЕНИЕ ИГРОКА =====
            function setupDeleteButtons() {
                const deleteButtons = document.querySelectorAll('.player-delete');
                deleteButtons.forEach((btn, index) => {
                    btn.removeEventListener('click', handleDeletePlayer);
                    btn.addEventListener('click', handleDeletePlayer);
                });
            }
            
            function handleDeletePlayer(e) {
                if (!this.classList.contains('active')) return;
                
                const playerCard = this.closest('.player-card');
                if (playerCard) {
                    playerCard.remove();
                    updatePlayerNumbers();
                    updatePlayerCounter();
                    updateDeleteButtonsState();
                    saveCurrentState();
                    updateTotalPrice();
                }
            }
            
            function updatePlayerNumbers() {
                const players = document.querySelectorAll('.player-card');
                players.forEach((player, index) => {
                    const nameEl = player.querySelector('.player-name');
                    if (nameEl) {
                        nameEl.textContent = `Игрок ${index + 1}`;
                    }
                });
            }
            
            function updatePlayerCounter() {
                const players = document.querySelectorAll('.player-card');
                playerCounter.textContent = `Кол-во игроков: ${players.length}`;
            }
            
            function updateDeleteButtonsState() {
                const players = document.querySelectorAll('.player-card');
                const deleteButtons = document.querySelectorAll('.player-delete');
                
                deleteButtons.forEach(btn => {
                    if (players.length <= 1) {
                        btn.classList.remove('active');
                        btn.disabled = true;
                    } else {
                        btn.classList.add('active');
                        btn.disabled = false;
                    }
                });
                
                feather.replace();
            }
            
            // ===== ДОБАВЛЕНИЕ ИГРОКА =====
            function addNewPlayer(skipSave = false) {
                const players = document.querySelectorAll('.player-card');
                const newPlayerNumber = players.length + 1;
                const isShorts = currentArticle === '120222';
                
                const newPlayer = document.createElement('div');
                newPlayer.className = 'player-card';
                newPlayer.innerHTML = `
                    <div class="player-header">
                        <span class="player-name">Игрок ${newPlayerNumber}</span>
                        <button class="player-delete ${newPlayerNumber > 1 ? 'active' : ''}" ${newPlayerNumber === 1 ? 'disabled' : ''}>
                            <i data-feather="trash-2"></i>
                        </button>
                    </div>
                    
                    <!-- Первая строка: Размер и Цвет нанесения -->
                    <div class="player-row">
                        <div class="field-group">
                            <label class="field-label">Размер</label>
                            <select class="field-select">
                                <option value="">Выберите размер</option>
                                <option value="XS">XS</option>
                                <option value="S">S</option>
                                <option value="M" selected>M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                                <option value="XXL">XXL</option>
                                <option value="XXXL">XXXL</option>
                            </select>
                        </div>
                        <div class="field-group">
                            <label class="field-label">Цвет нанесения</label>
                            <select class="field-select color-select">
                                <option value="white" selected>Белый</option>
                                <option value="black">Чёрный</option>
                                <option value="red">Красный</option>
                                <option value="blue">Синий</option>
                                <option value="yellow">Жёлтый</option>
                                <option value="green">Зелёный</option>
                                <option value="orange">Оранжевый</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Вторая строка: Фамилия, Большой номер, Малый номер -->
                    <div class="player-row">
                        <div class="field-group">
                            <label class="field-label">Фамилия/команда (290 ₽)</label>
                            <input class="field-input ${isShorts ? 'disabled-field' : ''}" type="text" placeholder="Введите фамилию" maxlength="12" value="" ${isShorts ? 'disabled' : ''}>
                        </div>
                        <div class="field-group">
                            <label class="field-label">Большой номер (190 ₽)</label>
                            <input class="field-input number-input ${isShorts ? 'disabled-field' : ''}" type="text" inputmode="numeric" pattern="\\d*" placeholder="0-99" value="" ${isShorts ? 'disabled' : ''}>
                            <div class="input-hint">только цифры</div>
                        </div>
                        <div class="field-group">
                            <label class="field-label">Малый номер (150 ₽)</label>
                            <input class="field-input number-input" type="text" inputmode="numeric" pattern="\\d*" placeholder="0-99" value="">
                            <div class="input-hint">только цифры</div>
                        </div>
                    </div>
                    
                    <!-- Третья строка: Чекбоксы для логотипов -->
                    <div class="player-row logos-row">
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" class="logo-checkbox team-logo">
                                <span>Логотип команды (320 ₽)</span>
                            </label>
                        </div>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" class="logo-checkbox sponsor-logo">
                                <span>Большой логотип (590 ₽)</span>
                            </label>
                        </div>
                    </div>
                `;
                
                playersContainer.appendChild(newPlayer);
                feather.replace();
                
                // Добавляем обработчики для чекбоксов
                const teamLogoCheckbox = newPlayer.querySelector('.team-logo');
                const sponsorLogoCheckbox = newPlayer.querySelector('.sponsor-logo');
                
                if (teamLogoCheckbox) {
                    teamLogoCheckbox.addEventListener('change', function() {
                        saveCurrentState();
                        updateTotalPrice();
                    });
                }
                
                if (sponsorLogoCheckbox) {
                    sponsorLogoCheckbox.addEventListener('change', function() {
                        saveCurrentState();
                        updateTotalPrice();
                    });
                }
                
                setupNumberInputs();
                setupDeleteButtons();
                updateDeleteButtonsState();
                updatePlayerCounter();
                
                if (!skipSave) {
                    saveCurrentState();
                }
                
                updateTotalPrice();
            }
            
            addPlayerBtn.addEventListener('click', () => addNewPlayer(false));
            
            // ===== ОБНОВЛЕНИЕ ЦЕНЫ =====
            function updateTotalPrice() {
                let total = 0;
                
                // Сохраняем состояние перед расчетом
                saveCurrentState();
                
                // Считаем по всем артикулам
                for (let article in itemsState) {
                    const state = itemsState[article];
                    
                    state.players.forEach(player => {
                        if (player.bigNumber && player.bigNumber.length > 0) total += PRICES.bigNumber;
                        if (player.smallNumber && player.smallNumber.length > 0) total += PRICES.smallNumber;
                        if (player.surname && player.surname.length > 0) total += PRICES.surname;
                        if (player.teamLogo) total += PRICES.teamLogo;
                        if (player.sponsorLogo) total += PRICES.sponsorLogo;
                    });
                }
                
                totalPriceValue.textContent = `${total.toLocaleString()} ₽`;
            }
            
            // ===== ФУНКЦИЯ ПОКАЗА МОДАЛЬНОГО ОКНА С ДЕТАЛИЗАЦИЕЙ =====
            function showConfirmationModal() {
                // Сохраняем состояние перед показом
                saveCurrentState();
                
                let html = '';
                let total = 0;
                
                // Перебираем все артикулы
                for (let article in itemsState) {
                    const state = itemsState[article];
                    const hasAnyServices = state.players.some(p => 
                        (p.bigNumber && p.bigNumber.length > 0) || 
                        (p.smallNumber && p.smallNumber.length > 0) || 
                        (p.surname && p.surname.length > 0) ||
                        p.teamLogo || p.sponsorLogo
                    );
                    
                    if (!hasAnyServices) continue;
                    
                    // Определяем товар по артикулу
                    const itemInfo = article === '120050' 
                        ? { name: 'Футболка игровая 2K Sport Classic III', price: 1190, image: 'https://private-user-images.githubusercontent.com/215157183/552557711-26061973-23d0-4930-a4b9-884fe271ddb0.jpg?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE1ODc2MzAsIm5iZiI6MTc3MTU4NzMzMCwicGF0aCI6Ii8yMTUxNTcxODMvNTUyNTU3NzExLTI2MDYxOTczLTIzZDAtNDkzMC1hNGI5LTg4NGZlMjcxZGRiMC5qcGc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjYwMjIwJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI2MDIyMFQxMTM1MzBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT00ZTBiZTQxZDg3OTkwYTJkNThlNWUwYzQ5ZjA2ZDY4NDA4ZWU4MGE1NGZiNDc5NTFlZGVkZDNlY2ZjMzQ1M2QzJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.P4pPUm3e3x7MxFCp-1hUpB904-_3vwhgBEbnNPgjY7E' }
                        : { name: 'Шорты игровые 2K Sport Classic III', price: 990, image: 'https://private-user-images.githubusercontent.com/215157183/552557745-67a1b9b8-530f-4134-bd7a-8ed6c613c442.jpg?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NzE1ODc2MzAsIm5iZiI6MTc3MTU4NzMzMCwicGF0aCI6Ii8yMTUxNTcxODMvNTUyNTU3NzQ1LTY3YTFiOWI4LTUzMGYtNDEzNC1iZDdhLThlZDZjNjEzYzQ0Mi5qcGc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjYwMjIwJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI2MDIyMFQxMTM1MzBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT04YjFlMDVhYjI0N2NiYjhmOGE3OThmMTkxNWE5NDIzYzEyM2QwZjI2MzAzNDkzZjYzNDBkMzYzZjY2OGZlMzljJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.Q1p_ymmTx38rsM31AHjSQ3HCSN2zrke3ngg0KncWy0w' };
                    
                    html += `<div class="confirm-item-group">`;
                    html += `<div class="confirm-item-header">`;
                    html += `<div class="confirm-item-image"><img src="${itemInfo.image}" alt="${itemInfo.name}"></div>`;
                    html += `<div><div class="confirm-item-title">${itemInfo.name}</div>`;
                    html += `<div class="confirm-item-art">Арт. ${article}</div></div>`;
                    html += `</div>`;
                    
                    html += `<div class="confirm-players-list">`;
                    
                    // Игроки
                    state.players.forEach((player, index) => {
                        const hasPlayerServices = (player.bigNumber && player.bigNumber.length > 0) || 
                                                  (player.smallNumber && player.smallNumber.length > 0) || 
                                                  (player.surname && player.surname.length > 0) ||
                                                  player.teamLogo || player.sponsorLogo;
                        
                        if (!hasPlayerServices) return;
                        
                        html += `<div class="confirm-player-item">`;
                        html += `<div class="confirm-player-name">Игрок ${index + 1} ${player.size ? '(размер ' + player.size + ')' : ''}</div>`;
                        html += `<div class="confirm-player-details">`;
                        
                        let playerTotal = 0;
                        
                        if (player.surname) {
                            html += `<div class="confirm-player-detail-row">
                                <span class="detail-label">Фамилия/команда:</span>
                                <span class="detail-value">${player.surname}</span>
                                <span class="detail-price">+290 ₽</span>
                            </div>`;
                            playerTotal += PRICES.surname;
                        }
                        if (player.bigNumber) {
                            html += `<div class="confirm-player-detail-row">
                                <span class="detail-label">Большой номер:</span>
                                <span class="detail-value">${player.bigNumber}</span>
                                <span class="detail-price">+190 ₽</span>
                            </div>`;
                            playerTotal += PRICES.bigNumber;
                        }
                        if (player.smallNumber) {
                            html += `<div class="confirm-player-detail-row">
                                <span class="detail-label">Малый номер:</span>
                                <span class="detail-value">${player.smallNumber}</span>
                                <span class="detail-price">+150 ₽</span>
                            </div>`;
                            playerTotal += PRICES.smallNumber;
                        }
                        if (player.teamLogo) {
                            html += `<div class="confirm-player-detail-row">
                                <span class="detail-label">Логотип команды:</span>
                                <span class="detail-value">✓</span>
                                <span class="detail-price">+320 ₽</span>
                            </div>`;
                            playerTotal += PRICES.teamLogo;
                        }
                        if (player.sponsorLogo) {
                            html += `<div class="confirm-player-detail-row">
                                <span class="detail-label">Большой логотип:</span>
                                <span class="detail-value">✓</span>
                                <span class="detail-price">+590 ₽</span>
                            </div>`;
                            playerTotal += PRICES.sponsorLogo;
                        }
                        
                        html += `<div class="confirm-player-total">Итого по игроку: ${playerTotal} ₽</div>`;
                        html += `</div></div>`;
                        total += playerTotal;
                    });
                    
                    html += `</div></div>`;
                    html += `<div class="confirm-item-divider"></div>`;
                }
                
                if (html === '') {
                    html = '<p style="text-align: center; color: #777; padding: 20px;">Нет выбранных услуг нанесения</p>';
                }
                
                confirmItemsList.innerHTML = html;
                confirmTotalPrice.textContent = `${total.toLocaleString()} ₽`;
                
                // Показываем модальное окно
                confirmModalOverlay.classList.add('active');
            }
            
            // ===== ОБРАБОТЧИКИ ДЛЯ МОДАЛЬНОГО ОКНА ПОДТВЕРЖДЕНИЯ =====
            document.getElementById('addToCartBtn').addEventListener('click', function() {
                showConfirmationModal();
            });
            
            closeConfirmModalBtn.addEventListener('click', function() {
                confirmModalOverlay.classList.remove('active');
            });
            
            continueShoppingBtn.addEventListener('click', function() {
                confirmModalOverlay.classList.remove('active');
                closeDrawer();
            });
            
            goToCartBtn.addEventListener('click', function() {
                confirmModalOverlay.classList.remove('active');
                closeDrawer();
                alert('Переход в корзину (в реальном проекте будет редирект)');
            });
            
            confirmModalOverlay.addEventListener('click', function(e) {
                if (e.target === confirmModalOverlay) {
                    confirmModalOverlay.classList.remove('active');
                }
            });
            
            // ===== ИНИЦИАЛИЗАЦИЯ =====
            addNewPlayer(true);
            
            setupNumberInputs();
            setupDeleteButtons();
            updateDeleteButtonsState();
            
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('field-input') || 
                    e.target.classList.contains('field-select')) {
                    saveCurrentState();
                    updateTotalPrice();
                }
            });
            
            document.querySelectorAll('.field-select').forEach(select => {
                select.addEventListener('change', function() {
                    saveCurrentState();
                    updateTotalPrice();
                });
            });
            
            document.getElementById('addToCartMainBtn').addEventListener('click', function() {
                alert('Товар добавлен в корзину. Теперь вы можете добавить нанесение.');
            });
        });
    </script>
</body>
</html>
